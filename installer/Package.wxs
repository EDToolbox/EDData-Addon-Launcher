<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Package Name="Elite Dangerous Addon Launcher V2" 
           Manufacturer="EDToolbox" 
           Version="2.0.5.0" 
           UpgradeCode="A1B2C3D4-E5F6-4A5B-8C9D-0E1F2A3B4C5D">
    
    <MajorUpgrade DowngradeErrorMessage="A newer version is already installed." />
    
    <Media Id="1" Cabinet="product.cab" EmbedCab="yes" />

    <!-- Installation directory with user-selectable path -->
    <StandardDirectory Id="ProgramFilesFolder">
      <Directory Id="INSTALLFOLDER" Name="Elite Dangerous Addon Launcher V2" />
    </StandardDirectory>

    <!-- Start Menu shortcuts -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="Elite Dangerous Addon Launcher V2" />
    </StandardDirectory>

    <!-- Desktop shortcut -->
    <StandardDirectory Id="DesktopFolder" />

    <!-- Main component group with all published files -->
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Id="MainExecutable">
        <File Source="$(var.PublishDir)\Elite Dangerous Addon Launcher V2.exe" KeyPath="yes">
          <Shortcut Id="StartMenuShortcut"
                    Directory="ApplicationProgramsFolder"
                    Name="Elite Dangerous Addon Launcher V2"
                    Description="Launch Elite Dangerous addons"
                    WorkingDirectory="INSTALLFOLDER"
                    Icon="ProductIcon" />
          <Shortcut Id="DesktopShortcut"
                    Directory="DesktopFolder"
                    Name="Elite Dangerous Addon Launcher V2"
                    Description="Launch Elite Dangerous addons"
                    WorkingDirectory="INSTALLFOLDER"
                    Icon="ProductIcon" />
        </File>
      </Component>

      <!-- All other published files -->
      <Component Id="AllOtherFiles">
        <File Source="$(var.PublishDir)\*.*" />
      </Component>
    </ComponentGroup>

    <!-- Application icon -->
    <Icon Id="ProductIcon" SourceFile="..\elite-dangerous-icon.ico" />

    <!-- License agreement -->
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />

    <!-- UI with custom install directory selection -->
    <UI>
      <UIRef Id="WixUI_InstallDir" />
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="LicenseAgreementDlg">1</Publish>
      <Publish Dialog="LicenseAgreementDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg">1</Publish>
      <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="LicenseAgreementDlg">1</Publish>
    </UI>
    
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

    <!-- Feature: Main application -->
    <Feature Id="ProductFeature" Title="Elite Dangerous Addon Launcher V2" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="ApplicationShortcut" />
    </Feature>

    <!-- Remove shortcuts on uninstall -->
    <Component Id="ApplicationShortcut" Directory="ApplicationProgramsFolder">
      <RemoveFolder Id="CleanupShortcuts" On="uninstall" />
      <RegistryValue Root="HKCU" 
                     Key="Software\EDToolbox\Elite Dangerous Addon Launcher V2" 
                     Name="installed" 
                     Type="integer" 
                     Value="1" 
                     KeyPath="yes" />
    </Component>

  </Package>
</Wix>
